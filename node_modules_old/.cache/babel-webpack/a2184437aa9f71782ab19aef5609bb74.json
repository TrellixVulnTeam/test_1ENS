{"ast":null,"code":"import _asyncToGenerator from \"C:/tal/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./util.service\";\nexport class CartService {\n  constructor(util) {\n    this.util = util;\n    this.cart = [];\n    this.itemId = [];\n    this.totalPrice = 0;\n    this.grandTotal = 0;\n    this.discount = 0;\n    this.orderTax = 0;\n    this.shippingPrice = 0;\n    this.minOrderPrice = 0;\n    this.freeShipping = 0;\n    this.deliveryPrice = 0;\n    this.stores = [];\n    this.paytmCreds = {\n      id: '',\n      key: '',\n      code: ''\n    };\n    this.instamojo = {\n      key: '',\n      token: '',\n      code: ''\n    };\n    this.paystack = {\n      sk: '',\n      pk: '',\n      code: ''\n    };\n    this.flutterwave = {\n      pk: '',\n      code: ''\n    };\n    this.userOrderTaxByStores = [];\n    const data = localStorage.getItem('cart');\n\n    if (data && data !== null && data !== 'null') {\n      const userCart = JSON.parse(data);\n\n      if (userCart && userCart.length > 0) {\n        this.cart = userCart;\n        this.itemId = [...new Set(this.cart.map(item => item.id))];\n        this.calcuate();\n      } else {\n        this.calcuate();\n      }\n    } else {\n      this.calcuate();\n    }\n  }\n\n  clearCart() {\n    this.cart = [];\n    this.itemId = [];\n    this.totalPrice = 0;\n    this.grandTotal = 0;\n    this.coupon = undefined;\n    this.discount = 0;\n    this.orderPrice = 0;\n    this.datetime = undefined;\n    this.stores = [];\n    this.deliveryAddress = null;\n    this.shippingPrice = 0;\n    this.deliveryPrice = 0;\n    this.util.clearKeys('cart');\n  }\n\n  addItem(item) {\n    console.log('item to adde', item);\n    this.cart.push(item);\n    this.itemId.push(item.id);\n    this.calcuate();\n  }\n\n  addQuantity(quantity, id) {\n    console.log('iddd-->>', id);\n    console.log('quantity', quantity);\n    this.cart.forEach(element => {\n      if (element.id === id) {\n        element.quantiy = quantity;\n      }\n    });\n    this.calcuate();\n  }\n\n  removeItem(id) {\n    console.log('remove this item from cart');\n    console.log('current cart items', this.cart);\n    this.cart = this.cart.filter(x => x.id !== id);\n    this.itemId = this.itemId.filter(x => x !== id);\n    console.log('====>>>>>>>>>', this.cart);\n    console.log('items====>>>', this.itemId);\n\n    if (this.cart.length) {\n      this.calcuate();\n    } else {\n      this.clearCart();\n    }\n  }\n\n  calcuate() {\n    var _this = this;\n\n    this.userOrderTaxByStores = [];\n    let total = 0;\n    this.cart.forEach(element => {\n      if (element && element.discount === '0') {\n        if (element.size === '1' || element.size === 1) {\n          if (element.variations[0].items[element.variant].discount && element.variations[0].items[element.variant].discount !== 0) {\n            total = total + parseFloat(element.variations[0].items[element.variant].discount) * element.quantiy;\n          } else {\n            total = total + parseFloat(element.variations[0].items[element.variant].price) * element.quantiy;\n          }\n        } else {\n          total = total + parseFloat(element.original_price) * element.quantiy;\n        }\n      } else {\n        if (element.size === '1' || element.size === 1) {\n          if (element.variations[0].items[element.variant].discount && element.variations[0].items[element.variant].discount !== 0) {\n            total = total + parseFloat(element.variations[0].items[element.variant].discount) * element.quantiy;\n          } else {\n            total = total + parseFloat(element.variations[0].items[element.variant].price) * element.quantiy;\n          }\n        } else {\n          total = total + parseFloat(element.sell_price) * element.quantiy;\n        }\n      }\n    });\n    this.totalPrice = total;\n\n    if (this.coupon && this.coupon.type) {\n      const min = parseFloat(this.coupon.min);\n\n      if (this.totalPrice >= min) {\n        if (this.coupon && this.coupon.type === 'per') {\n          function percentage(num, per) {\n            return num / 100 * per;\n          }\n\n          const totalPrice = percentage(parseFloat(this.totalPrice).toFixed(2), parseFloat(this.coupon.off));\n          this.discount = totalPrice.toFixed(2);\n          this.grandTotal = this.totalPrice - parseFloat(this.discount) + this.orderTax;\n        } else {\n          this.discount = this.coupon.off;\n          this.grandTotal = this.totalPrice - parseFloat(this.discount) + this.orderTax;\n        }\n      } else {\n        this.discount = 0;\n        this.coupon = null;\n      }\n    } else {\n      this.grandTotal = this.totalPrice + this.orderTax;\n    }\n\n    if (this.stores && this.stores.length && this.deliveryAddress && this.deliveryAt === 'home') {\n      let totalKM = 0;\n      let taxEach = 0;\n      this.stores.forEach( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (element) {\n          const distance = yield _this.distanceInKmBetweenEarthCoordinates(_this.deliveryAddress.lat, _this.deliveryAddress.lng, element.lat, element.lng);\n          totalKM = totalKM + distance;\n          console.log('total->', element.name, totalKM * _this.shippingPrice); // const storeCount = this.stores.length + 1;\n\n          taxEach = _this.orderTax / _this.stores.length;\n          const extraChargeParam = {\n            store_id: element.uid,\n            distance: distance.toFixed(2),\n            tax: taxEach.toFixed(2),\n            shipping: _this.shipping,\n            shippingPrice: _this.shippingPrice\n          };\n          console.log(extraChargeParam);\n\n          _this.userOrderTaxByStores.push(extraChargeParam);\n        });\n\n        return function (_x) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n      console.log('00-->>', this.userOrderTaxByStores);\n      setTimeout(() => {\n        if (this.freeShipping > this.totalPrice) {\n          if (this.shipping === 'km') {\n            const distancePricer = totalKM * this.shippingPrice;\n            console.log('====================> KM price', distancePricer);\n            this.deliveryPrice = Math.floor(distancePricer).toFixed(2);\n            this.grandTotal = this.totalPrice - parseFloat(this.discount) + this.orderTax + distancePricer;\n            this.grandTotal = parseFloat(this.grandTotal).toFixed(2);\n            console.log('grand total===>>', this.grandTotal);\n          } else {\n            this.deliveryPrice = this.shippingPrice;\n            this.grandTotal = this.totalPrice - parseFloat(this.discount) + this.orderTax + this.shippingPrice;\n            this.grandTotal = parseFloat(this.grandTotal).toFixed(2);\n          }\n        } else {\n          this.deliveryPrice = 0;\n          this.grandTotal = this.totalPrice - parseFloat(this.discount) + this.orderTax;\n          this.grandTotal = parseFloat(this.grandTotal).toFixed(2);\n        }\n      }, 1000);\n    } else {\n      let taxEach = 0;\n      this.stores.forEach( /*#__PURE__*/function () {\n        var _ref2 = _asyncToGenerator(function* (element) {\n          taxEach = _this.orderTax / _this.stores.length;\n          const extraChargeParam = {\n            store_id: element.uid,\n            distance: 0,\n            tax: taxEach.toFixed(2),\n            shipping: _this.shipping,\n            shippingPrice: _this.shippingPrice\n          };\n          console.log(extraChargeParam);\n\n          _this.userOrderTaxByStores.push(extraChargeParam);\n        });\n\n        return function (_x2) {\n          return _ref2.apply(this, arguments);\n        };\n      }());\n      this.deliveryPrice = 0;\n      this.discount = this.discount === null || this.discount === 0 || !this.discount ? 0 : this.discount;\n      this.grandTotal = this.totalPrice - parseFloat(this.discount) + parseFloat(this.orderTax);\n      this.grandTotal = parseFloat(this.grandTotal).toFixed(2);\n    }\n\n    if (isNaN(this.grandTotal)) {\n      // this.util.publishPriceOfCart();\n      console.log('its nan value>> current', this);\n      console.log('util', this.util);\n    }\n\n    console.log('this.grandtotal', this.grandTotal);\n    this.util.setKeys('cart', JSON.stringify(this.cart));\n  }\n\n  checkProductInCart(id) {\n    return this.itemId.includes(id);\n  }\n\n  degreesToRadians(degrees) {\n    return degrees * Math.PI / 180;\n  }\n\n  distanceInKmBetweenEarthCoordinates(lat1, lon1, lat2, lon2) {\n    console.log(lat1, lon1, lat2, lon2);\n    const earthRadiusKm = 6371;\n    const dLat = this.degreesToRadians(lat2 - lat1);\n    const dLon = this.degreesToRadians(lon2 - lon1);\n    lat1 = this.degreesToRadians(lat1);\n    lat2 = this.degreesToRadians(lat2);\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return earthRadiusKm * c;\n  }\n\n}\n\nCartService.ɵfac = function CartService_Factory(t) {\n  return new (t || CartService)(i0.ɵɵinject(i1.UtilService));\n};\n\nCartService.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n  token: CartService,\n  factory: CartService.ɵfac,\n  providedIn: 'root'\n});","map":{"version":3,"sources":["C:\\tal\\src\\app\\services\\cart.service.ts"],"names":[],"mappings":"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","sourcesContent":["/*\n  Authors : initappz (Rahul Jograna)\n  Website : https://initappz.com/\n  App Name : ionic 5 groceryee app\n  Created : 10-Sep-2020\n  This App Template Source code is licensed as per the\n  terms found in the Website https://initappz.com/license\n  Copyright and Good Faith Purchasers © 2020-present initappz.\n*/\nimport { Injectable } from '@angular/core';\nimport { UtilService } from './util.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class CartService {\n  public cart: any[] = [];\n  public itemId: any[] = [];\n  public totalPrice: any = 0;\n  public grandTotal: any = 0;\n  public coupon: any;\n  public discount: any = 0;\n  public orderTax: any = 0;\n  public orderPrice: any;\n  public shipping: any;\n  public shippingPrice: any = 0;\n  public minOrderPrice: any = 0;\n  public freeShipping: any = 0;\n  public datetime: any;\n  public deliveryAt: any;\n  public deliveryAddress: any;\n  public deliveryPrice: any = 0;\n  public stores: any[] = [];\n\n\n  public havePayment: boolean;\n  public haveStripe: boolean;\n  public haveRazor: boolean;\n  public haveCOD: boolean;\n  public havePayPal: boolean;\n  public havePayTM: boolean;\n  public havePayStack: boolean;\n  public haveFlutterwave: boolean;\n  public paytmCreds = {\n    id: '',\n    key: '',\n    code: ''\n  };\n\n  public paytmENV: any;\n\n  haveInstamojo: boolean;\n  instamojo = {\n    key: '',\n    token: '',\n    code: ''\n  };\n  instaENV: any;\n\n  public paystack = {\n    sk: '',\n    pk: '',\n    code: ''\n  };\n  public flutterwave = {\n    pk: '',\n    code: ''\n  }\n  public userOrderTaxByStores: any[] = [];\n  constructor(\n    public util: UtilService\n  ) {\n    const data = localStorage.getItem('cart');\n    if (data && data !== null && data !== 'null') {\n      const userCart = JSON.parse(data);\n      if (userCart && userCart.length > 0) {\n        this.cart = userCart;\n        this.itemId = [...new Set(this.cart.map(item => item.id))];\n        this.calcuate();\n      } else {\n        this.calcuate();\n      }\n    } else {\n      this.calcuate();\n    }\n\n  }\n\n\n\n  clearCart() {\n    this.cart = [];\n    this.itemId = [];\n    this.totalPrice = 0;\n    this.grandTotal = 0;\n    this.coupon = undefined;\n    this.discount = 0;\n    this.orderPrice = 0;\n    this.datetime = undefined;\n    this.stores = [];\n    this.deliveryAddress = null;\n    this.shippingPrice = 0;\n    this.deliveryPrice = 0;\n    this.util.clearKeys('cart');\n  }\n\n  addItem(item) {\n    console.log('item to adde', item);\n    this.cart.push(item);\n    this.itemId.push(item.id);\n    this.calcuate();\n  }\n\n  addQuantity(quantity, id) {\n    console.log('iddd-->>', id);\n    console.log('quantity', quantity);\n    this.cart.forEach(element => {\n      if (element.id === id) {\n        element.quantiy = quantity;\n      }\n    });\n    this.calcuate();\n  }\n\n  removeItem(id) {\n    console.log('remove this item from cart');\n    console.log('current cart items', this.cart);\n    this.cart = this.cart.filter(x => x.id !== id);\n    this.itemId = this.itemId.filter(x => x !== id);\n\n    console.log('====>>>>>>>>>', this.cart);\n    console.log('items====>>>', this.itemId);\n    if (this.cart.length) {\n      this.calcuate();\n    } else {\n      this.clearCart();\n    }\n  }\n\n  calcuate() {\n    this.userOrderTaxByStores = [];\n    let total = 0;\n    this.cart.forEach(element => {\n      if (element && element.discount === '0') {\n        if (element.size === '1' || element.size === 1) {\n          if (element.variations[0].items[element.variant].discount && element.variations[0].items[element.variant].discount !== 0) {\n            total = total + (parseFloat(element.variations[0].items[element.variant].discount) * element.quantiy);\n          } else {\n            total = total + (parseFloat(element.variations[0].items[element.variant].price) * element.quantiy);\n          }\n        } else {\n          total = total + (parseFloat(element.original_price) * element.quantiy);\n        }\n      } else {\n        if (element.size === '1' || element.size === 1) {\n          if (element.variations[0].items[element.variant].discount && element.variations[0].items[element.variant].discount !== 0) {\n            total = total + (parseFloat(element.variations[0].items[element.variant].discount) * element.quantiy);\n          } else {\n            total = total + (parseFloat(element.variations[0].items[element.variant].price) * element.quantiy);\n          }\n        } else {\n          total = total + (parseFloat(element.sell_price) * element.quantiy);\n        }\n      }\n    });\n\n    this.totalPrice = total;\n\n    if (this.coupon && this.coupon.type) {\n      const min = parseFloat(this.coupon.min);\n      if (this.totalPrice >= min) {\n        if (this.coupon && this.coupon.type === 'per') {\n          function percentage(num, per) {\n            return (num / 100) * per;\n          }\n          const totalPrice = percentage(parseFloat(this.totalPrice).toFixed(2), parseFloat(this.coupon.off));\n          this.discount = totalPrice.toFixed(2);\n          this.grandTotal = (this.totalPrice - parseFloat(this.discount)) + this.orderTax;\n        } else {\n          this.discount = this.coupon.off;\n          this.grandTotal = (this.totalPrice - parseFloat(this.discount)) + this.orderTax;\n        }\n      } else {\n        this.discount = 0;\n        this.coupon = null;\n      }\n    } else {\n      this.grandTotal = this.totalPrice + this.orderTax;\n    }\n    if (this.stores && this.stores.length && this.deliveryAddress && this.deliveryAt === 'home') {\n      let totalKM = 0;\n      let taxEach = 0;\n      this.stores.forEach(async (element) => {\n        const distance = await this.distanceInKmBetweenEarthCoordinates(this.deliveryAddress.lat, this.deliveryAddress.lng,\n          element.lat, element.lng);\n        totalKM = totalKM + distance;\n        console.log('total->', element.name, totalKM * this.shippingPrice);\n        // const storeCount = this.stores.length + 1;\n        taxEach = this.orderTax / this.stores.length;\n        const extraChargeParam = {\n          store_id: element.uid,\n          distance: distance.toFixed(2),\n          tax: taxEach.toFixed(2),\n          shipping: this.shipping,\n          shippingPrice: this.shippingPrice\n        };\n        console.log(extraChargeParam);\n        this.userOrderTaxByStores.push(extraChargeParam);\n      });\n      console.log('00-->>', this.userOrderTaxByStores);\n      setTimeout(() => {\n        if (this.freeShipping > this.totalPrice) {\n          if (this.shipping === 'km') {\n            const distancePricer = totalKM * this.shippingPrice;\n            console.log('====================> KM price', distancePricer);\n            this.deliveryPrice = Math.floor(distancePricer).toFixed(2);\n            this.grandTotal = (this.totalPrice - parseFloat(this.discount)) + this.orderTax + distancePricer;\n            this.grandTotal = parseFloat(this.grandTotal).toFixed(2);\n            console.log('grand total===>>', this.grandTotal);\n          } else {\n            this.deliveryPrice = this.shippingPrice;\n            this.grandTotal = (this.totalPrice - parseFloat(this.discount)) + this.orderTax + this.shippingPrice;\n            this.grandTotal = parseFloat(this.grandTotal).toFixed(2);\n          }\n\n        } else {\n          this.deliveryPrice = 0;\n          this.grandTotal = (this.totalPrice - parseFloat(this.discount)) + this.orderTax;\n          this.grandTotal = parseFloat(this.grandTotal).toFixed(2);\n        }\n      }, 1000);\n\n    } else {\n      let taxEach = 0;\n      this.stores.forEach(async (element) => {\n        taxEach = this.orderTax / this.stores.length;\n        const extraChargeParam = {\n          store_id: element.uid,\n          distance: 0,\n          tax: taxEach.toFixed(2),\n          shipping: this.shipping,\n          shippingPrice: this.shippingPrice\n        };\n        console.log(extraChargeParam);\n        this.userOrderTaxByStores.push(extraChargeParam);\n      });\n      this.deliveryPrice = 0;\n      this.discount = this.discount === null || this.discount === 0 || !this.discount ? 0 : this.discount;\n      this.grandTotal = (this.totalPrice - parseFloat(this.discount)) + parseFloat(this.orderTax);\n      this.grandTotal = parseFloat(this.grandTotal).toFixed(2);\n    }\n    if (isNaN(this.grandTotal)) {\n      // this.util.publishPriceOfCart();\n      console.log('its nan value>> current', this);\n      console.log('util', this.util);\n    }\n    console.log('this.grandtotal', this.grandTotal);\n    this.util.setKeys('cart', JSON.stringify(this.cart));\n  }\n\n  checkProductInCart(id) {\n    return this.itemId.includes(id);\n  }\n\n  degreesToRadians(degrees) {\n    return degrees * Math.PI / 180;\n  }\n\n  distanceInKmBetweenEarthCoordinates(lat1, lon1, lat2, lon2) {\n    console.log(lat1, lon1, lat2, lon2);\n    const earthRadiusKm = 6371;\n\n    const dLat = this.degreesToRadians(lat2 - lat1);\n    const dLon = this.degreesToRadians(lon2 - lon1);\n\n    lat1 = this.degreesToRadians(lat1);\n    lat2 = this.degreesToRadians(lat2);\n\n    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return earthRadiusKm * c;\n  }\n}\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}