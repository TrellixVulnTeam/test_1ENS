{"ast":null,"code":"import _asyncToGenerator from \"C:/tal/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport * as moment from 'moment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/services/api.service\";\nimport * as i3 from \"src/app/services/util.service\";\nimport * as i4 from \"src/app/services/cart.service\";\nexport class FlutterwavecallbackComponent {\n  constructor(route, api, util, cart, router) {\n    this.route = route;\n    this.api = api;\n    this.util = util;\n    this.cart = cart;\n    this.router = router;\n    this.route.queryParams.subscribe(data => {\n      console.log(data);\n\n      if (data && data.status === 'successful') {\n        if ((x => {\n          try {\n            JSON.parse(x);\n            return true;\n          } catch (e) {\n            return false;\n          }\n        })(localStorage.getItem('cartItems'))) {\n          this.cart.cart = JSON.parse(localStorage.getItem('cartItems'));\n          this.cart.deliveryAt = localStorage.getItem('deliveryAt');\n          this.cart.datetime = localStorage.getItem('datetime');\n          this.cart.totalPrice = localStorage.getItem('totalPrice');\n          this.cart.orderTax = localStorage.getItem('orderTax');\n          this.cart.grandTotal = localStorage.getItem('grandTotal');\n          this.cart.deliveryPrice = localStorage.getItem('deliveryPrice');\n\n          if ((x => {\n            try {\n              JSON.parse(x);\n              return true;\n            } catch (e) {\n              return false;\n            }\n          })(localStorage.getItem('appliedCoupon'))) {\n            this.cart.coupon = JSON.parse(localStorage.getItem('appliedCoupon'));\n          } else {\n            this.cart.coupon = null;\n          }\n\n          if ((x => {\n            try {\n              JSON.parse(x);\n              return true;\n            } catch (e) {\n              return false;\n            }\n          })(localStorage.getItem('userOrderTaxByStores'))) {\n            this.cart.userOrderTaxByStores = JSON.parse(localStorage.getItem('userOrderTaxByStores'));\n          } else {\n            this.cart.userOrderTaxByStores = [];\n          }\n\n          if ((x => {\n            try {\n              JSON.parse(x);\n              return true;\n            } catch (e) {\n              return false;\n            }\n          })(localStorage.getItem('selectedAddress'))) {\n            this.cart.deliveryAddress = JSON.parse(localStorage.getItem('selectedAddress'));\n          } else {\n            this.cart.deliveryAddress = null;\n          }\n\n          this.cart.discount = localStorage.getItem('discount');\n          console.log('cart instance calcuatelllll,,,,,', this.cart);\n          this.createOrder('flutterwave', data.transaction_id);\n        } else {\n          console.log('somerthing went wrong');\n          localStorage.removeItem('cartItems');\n          localStorage.removeItem('deliveryAt');\n          localStorage.removeItem('datetime');\n          localStorage.removeItem('totalPrice');\n          localStorage.removeItem('orderTax');\n          localStorage.removeItem('grandTotal');\n          localStorage.removeItem('deliveryPrice');\n          localStorage.removeItem('appliedCoupon');\n          localStorage.removeItem('userOrderTaxByStores');\n          localStorage.removeItem('discount');\n          localStorage.removeItem('selectedAddress');\n          this.util.errorMessage(this.util.translate('Something went wrong'));\n        }\n      } else {\n        localStorage.removeItem('cartItems');\n        localStorage.removeItem('deliveryAt');\n        localStorage.removeItem('datetime');\n        localStorage.removeItem('totalPrice');\n        localStorage.removeItem('orderTax');\n        localStorage.removeItem('grandTotal');\n        localStorage.removeItem('deliveryPrice');\n        localStorage.removeItem('appliedCoupon');\n        localStorage.removeItem('userOrderTaxByStores');\n        localStorage.removeItem('discount');\n        localStorage.removeItem('selectedAddress');\n        this.util.errorMessage(this.util.translate('Something went wrong'));\n        this.router.navigate(['']);\n      }\n    });\n  }\n\n  ngOnInit() {}\n\n  createOrder(payMethod, payKey) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      //////////// new\n      //////////// new\n      const storeId = [...new Set(_this.cart.cart.map(item => item.store_id))];\n      const orderStatus = [];\n      storeId.forEach(element => {\n        const info = {\n          id: element,\n          status: 'created'\n        };\n        orderStatus.push(info);\n      });\n      const notes = [{\n        status: 1,\n        value: 'Order Created',\n        time: moment().format('lll')\n      }];\n      _this.cart.deliveryAt = _this.cart.deliveryAt ? _this.cart.deliveryAt : '';\n      const param = {\n        uid: localStorage.getItem('uid'),\n        store_id: storeId.join(),\n        date_time: _this.cart.datetime === 'today' ? moment().format('YYYY-MM-DD HH:mm:ss') : moment().add(1, 'days').format('YYYY-MM-DD HH:mm:ss'),\n        paid_method: payMethod,\n        order_to: _this.cart.deliveryAt,\n        orders: JSON.stringify(_this.cart.cart),\n        notes: JSON.stringify(notes),\n        address: _this.cart.deliveryAt === 'home' ? JSON.stringify(_this.cart.deliveryAddress) : '',\n        driver_id: '',\n        total: _this.cart.totalPrice,\n        tax: _this.cart.orderTax,\n        grand_total: _this.cart.grandTotal,\n        delivery_charge: _this.cart.deliveryPrice,\n        coupon_code: _this.cart.coupon ? JSON.stringify(_this.cart.coupon) : '',\n        discount: _this.cart.discount,\n        pay_key: payKey,\n        status: JSON.stringify(orderStatus),\n        assignee: '',\n        extra: JSON.stringify(_this.cart.userOrderTaxByStores)\n      };\n      console.log('param----->', param);\n\n      _this.util.start();\n\n      _this.api.post_private('orders/save', param).then(data => {\n        console.log(data);\n\n        _this.util.stop();\n\n        localStorage.removeItem('cartItems');\n        localStorage.removeItem('deliveryAt');\n        localStorage.removeItem('datetime');\n        localStorage.removeItem('totalPrice');\n        localStorage.removeItem('orderTax');\n        localStorage.removeItem('grandTotal');\n        localStorage.removeItem('deliveryPrice');\n        localStorage.removeItem('appliedCoupon');\n        localStorage.removeItem('userOrderTaxByStores');\n        localStorage.removeItem('discount');\n        localStorage.removeItem('selectedAddress');\n\n        _this.util.errorMessage(_this.util.translate('Something went wrong'));\n\n        _this.api.createOrderNotification(_this.cart.stores);\n\n        _this.cart.clearCart();\n\n        _this.util.publishNewOrder(); // this.router.navigate(['orders']);\n\n\n        const name = (_this.util.userInfo.first_name + '-' + _this.util.userInfo.last_name).toLowerCase();\n\n        _this.router.navigate(['user', name, 'order']);\n      }, error => {\n        console.log(error);\n\n        _this.util.stop();\n\n        localStorage.removeItem('cartItems');\n        localStorage.removeItem('deliveryAt');\n        localStorage.removeItem('datetime');\n        localStorage.removeItem('totalPrice');\n        localStorage.removeItem('orderTax');\n        localStorage.removeItem('grandTotal');\n        localStorage.removeItem('deliveryPrice');\n        localStorage.removeItem('appliedCoupon');\n        localStorage.removeItem('userOrderTaxByStores');\n        localStorage.removeItem('discount');\n        localStorage.removeItem('selectedAddress');\n\n        _this.util.errorMessage(_this.util.translate('Something went wrong'));\n\n        _this.util.errorMessage(_this.util.translate('Something went wrong'));\n      }).catch(error => {\n        console.log(error);\n\n        _this.util.stop();\n\n        localStorage.removeItem('cartItems');\n        localStorage.removeItem('deliveryAt');\n        localStorage.removeItem('datetime');\n        localStorage.removeItem('totalPrice');\n        localStorage.removeItem('orderTax');\n        localStorage.removeItem('grandTotal');\n        localStorage.removeItem('deliveryPrice');\n        localStorage.removeItem('appliedCoupon');\n        localStorage.removeItem('userOrderTaxByStores');\n        localStorage.removeItem('discount');\n        localStorage.removeItem('selectedAddress');\n\n        _this.util.errorMessage(_this.util.translate('Something went wrong'));\n\n        _this.util.errorMessage(_this.util.translate('Something went wrong'));\n      });\n    })();\n  }\n\n}\n\nFlutterwavecallbackComponent.ɵfac = function FlutterwavecallbackComponent_Factory(t) {\n  return new (t || FlutterwavecallbackComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i2.ApiService), i0.ɵɵdirectiveInject(i3.UtilService), i0.ɵɵdirectiveInject(i4.CartService), i0.ɵɵdirectiveInject(i1.Router));\n};\n\nFlutterwavecallbackComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: FlutterwavecallbackComponent,\n  selectors: [[\"app-flutterwavecallback\"]],\n  decls: 2,\n  vars: 1,\n  consts: [[2, \"text-align\", \"center\"]],\n  template: function FlutterwavecallbackComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"h2\", 0);\n      i0.ɵɵtext(1);\n      i0.ɵɵelementEnd();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵadvance(1);\n      i0.ɵɵtextInterpolate1(\" \", ctx.util.translate(\"Please wait, we are processing your order\"), \" \");\n    }\n  },\n  styles: [\"@charset \\\"UTF-8\\\";\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZsdXR0ZXJ3YXZlY2FsbGJhY2suY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsZ0JBQWdCO0FBQWhCOzs7Ozs7OztDQUFBIiwiZmlsZSI6ImZsdXR0ZXJ3YXZlY2FsbGJhY2suY29tcG9uZW50LnNjc3MiLCJzb3VyY2VzQ29udGVudCI6WyJAY2hhcnNldCBcIlVURi04XCI7XG4vKlxuICBBdXRob3JzIDogaW5pdGFwcHogKFJhaHVsIEpvZ3JhbmEpXG4gIFdlYnNpdGUgOiBodHRwczovL2luaXRhcHB6LmNvbS9cbiAgQXBwIE5hbWUgOiBpb25pYyA1IGdyb2NlcnllZSBhcHBcbiAgQ3JlYXRlZCA6IDEwLVNlcC0yMDIwXG4gIFRoaXMgQXBwIFRlbXBsYXRlIFNvdXJjZSBjb2RlIGlzIGxpY2Vuc2VkIGFzIHBlciB0aGVcbiAgdGVybXMgZm91bmQgaW4gdGhlIFdlYnNpdGUgaHR0cHM6Ly9pbml0YXBwei5jb20vbGljZW5zZVxuICBDb3B5cmlnaHQgYW5kIEdvb2QgRmFpdGggUHVyY2hhc2VycyDCqSAyMDIwLXByZXNlbnQgaW5pdGFwcHouXG4qLyJdfQ== */\"]\n});","map":{"version":3,"sources":["C:\\tal\\src\\app\\components\\flutterwavecallback\\flutterwavecallback.component.ts","C:\\tal\\src\\app\\components\\flutterwavecallback\\flutterwavecallback.component.html"],"names":[],"mappings":"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","sourcesContent":["/*\n  Authors : initappz (Rahul Jograna)\n  Website : https://initappz.com/\n  App Name : ionic 5 groceryee app\n  Created : 10-Sep-2020\n  This App Template Source code is licensed as per the\n  terms found in the Website https://initappz.com/license\n  Copyright and Good Faith Purchasers © 2020-present initappz.\n*/\nimport { Component, OnInit } from '@angular/core';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { CartService } from 'src/app/services/cart.service';\nimport { UtilService } from 'src/app/services/util.service';\nimport { ApiService } from 'src/app/services/api.service';\nimport * as moment from 'moment';\n@Component({\n  selector: 'app-flutterwavecallback',\n  templateUrl: './flutterwavecallback.component.html',\n  styleUrls: ['./flutterwavecallback.component.scss']\n})\nexport class FlutterwavecallbackComponent implements OnInit {\n\n  constructor(\n    private route: ActivatedRoute,\n    public api: ApiService,\n    public util: UtilService,\n    public cart: CartService,\n    private router: Router\n  ) {\n    this.route.queryParams.subscribe((data) => {\n      console.log(data);\n      if (data && data.status === 'successful') {\n        if (((x) => { try { JSON.parse(x); return true; } catch (e) { return false } })(localStorage.getItem('cartItems'))) {\n\n          this.cart.cart = JSON.parse(localStorage.getItem('cartItems'));\n          this.cart.deliveryAt = localStorage.getItem('deliveryAt');\n          this.cart.datetime = localStorage.getItem('datetime');\n          this.cart.totalPrice = localStorage.getItem('totalPrice');\n          this.cart.orderTax = localStorage.getItem('orderTax');\n          this.cart.grandTotal = localStorage.getItem('grandTotal');\n          this.cart.deliveryPrice = localStorage.getItem('deliveryPrice');\n          if (((x) => { try { JSON.parse(x); return true; } catch (e) { return false } })(localStorage.getItem('appliedCoupon'))) {\n            this.cart.coupon = JSON.parse(localStorage.getItem('appliedCoupon'))\n          } else {\n            this.cart.coupon = null;\n          }\n          if (((x) => { try { JSON.parse(x); return true; } catch (e) { return false } })(localStorage.getItem('userOrderTaxByStores'))) {\n            this.cart.userOrderTaxByStores = JSON.parse(localStorage.getItem('userOrderTaxByStores'))\n          } else {\n            this.cart.userOrderTaxByStores = [];\n          }\n          if (((x) => { try { JSON.parse(x); return true; } catch (e) { return false } })(localStorage.getItem('selectedAddress'))) {\n            this.cart.deliveryAddress = JSON.parse(localStorage.getItem('selectedAddress'))\n          } else {\n            this.cart.deliveryAddress = null;\n          }\n\n          this.cart.discount = localStorage.getItem('discount');\n\n          console.log('cart instance calcuatelllll,,,,,', this.cart);\n          this.createOrder('flutterwave', data.transaction_id);\n        } else {\n          console.log('somerthing went wrong');\n          localStorage.removeItem('cartItems');\n          localStorage.removeItem('deliveryAt');\n          localStorage.removeItem('datetime');\n          localStorage.removeItem('totalPrice');\n          localStorage.removeItem('orderTax');\n          localStorage.removeItem('grandTotal');\n          localStorage.removeItem('deliveryPrice');\n          localStorage.removeItem('appliedCoupon');\n          localStorage.removeItem('userOrderTaxByStores');\n          localStorage.removeItem('discount');\n          localStorage.removeItem('selectedAddress');\n          this.util.errorMessage(this.util.translate('Something went wrong'));\n        }\n\n      } else {\n        localStorage.removeItem('cartItems');\n        localStorage.removeItem('deliveryAt');\n        localStorage.removeItem('datetime');\n        localStorage.removeItem('totalPrice');\n        localStorage.removeItem('orderTax');\n        localStorage.removeItem('grandTotal');\n        localStorage.removeItem('deliveryPrice');\n        localStorage.removeItem('appliedCoupon');\n        localStorage.removeItem('userOrderTaxByStores');\n        localStorage.removeItem('discount');\n        localStorage.removeItem('selectedAddress');\n        this.util.errorMessage(this.util.translate('Something went wrong'));\n        this.router.navigate(['']);\n      }\n    });\n  }\n\n  ngOnInit(): void {\n  }\n\n  async createOrder(payMethod, payKey) {\n    //////////// new\n    //////////// new\n\n    const storeId = [...new Set(this.cart.cart.map(item => item.store_id))];\n    const orderStatus = [];\n    storeId.forEach(element => {\n      const info = {\n        id: element,\n        status: 'created'\n      };\n      orderStatus.push(info);\n    });\n    const notes = [\n      {\n        status: 1,\n        value: 'Order Created',\n        time: moment().format('lll'),\n      }\n    ];\n    this.cart.deliveryAt = this.cart.deliveryAt ? this.cart.deliveryAt : '';\n    const param = {\n      uid: localStorage.getItem('uid'),\n      store_id: storeId.join(),\n      date_time: this.cart.datetime === 'today' ? moment().format('YYYY-MM-DD HH:mm:ss') : moment().add(1, 'days').format('YYYY-MM-DD HH:mm:ss'),\n      paid_method: payMethod,\n      order_to: this.cart.deliveryAt,\n      orders: JSON.stringify(this.cart.cart),\n      notes: JSON.stringify(notes),\n      address: this.cart.deliveryAt === 'home' ? JSON.stringify(this.cart.deliveryAddress) : '',\n      driver_id: '',\n      total: this.cart.totalPrice,\n      tax: this.cart.orderTax,\n      grand_total: this.cart.grandTotal,\n      delivery_charge: this.cart.deliveryPrice,\n      coupon_code: this.cart.coupon ? JSON.stringify(this.cart.coupon) : '',\n      discount: this.cart.discount,\n      pay_key: payKey,\n      status: JSON.stringify(orderStatus),\n      assignee: '',\n      extra: JSON.stringify(this.cart.userOrderTaxByStores)\n    };\n\n    console.log('param----->', param);\n\n    this.util.start();\n    this.api.post_private('orders/save', param).then((data: any) => {\n      console.log(data);\n      this.util.stop();\n      localStorage.removeItem('cartItems');\n      localStorage.removeItem('deliveryAt');\n      localStorage.removeItem('datetime');\n      localStorage.removeItem('totalPrice');\n      localStorage.removeItem('orderTax');\n      localStorage.removeItem('grandTotal');\n      localStorage.removeItem('deliveryPrice');\n      localStorage.removeItem('appliedCoupon');\n      localStorage.removeItem('userOrderTaxByStores');\n      localStorage.removeItem('discount');\n      localStorage.removeItem('selectedAddress');\n      this.util.errorMessage(this.util.translate('Something went wrong'));\n      this.api.createOrderNotification(this.cart.stores);\n      this.cart.clearCart();\n      this.util.publishNewOrder();\n      // this.router.navigate(['orders']);\n      const name = (this.util.userInfo.first_name + '-' + this.util.userInfo.last_name).toLowerCase();\n      this.router.navigate(['user', name, 'order']);\n    }, error => {\n      console.log(error);\n      this.util.stop();\n      localStorage.removeItem('cartItems');\n      localStorage.removeItem('deliveryAt');\n      localStorage.removeItem('datetime');\n      localStorage.removeItem('totalPrice');\n      localStorage.removeItem('orderTax');\n      localStorage.removeItem('grandTotal');\n      localStorage.removeItem('deliveryPrice');\n      localStorage.removeItem('appliedCoupon');\n      localStorage.removeItem('userOrderTaxByStores');\n      localStorage.removeItem('discount');\n      localStorage.removeItem('selectedAddress');\n      this.util.errorMessage(this.util.translate('Something went wrong'));\n      this.util.errorMessage(this.util.translate('Something went wrong'));\n    }).catch((error) => {\n      console.log(error);\n      this.util.stop();\n      localStorage.removeItem('cartItems');\n      localStorage.removeItem('deliveryAt');\n      localStorage.removeItem('datetime');\n      localStorage.removeItem('totalPrice');\n      localStorage.removeItem('orderTax');\n      localStorage.removeItem('grandTotal');\n      localStorage.removeItem('deliveryPrice');\n      localStorage.removeItem('appliedCoupon');\n      localStorage.removeItem('userOrderTaxByStores');\n      localStorage.removeItem('discount');\n      localStorage.removeItem('selectedAddress');\n      this.util.errorMessage(this.util.translate('Something went wrong'));\n      this.util.errorMessage(this.util.translate('Something went wrong'));\n    });\n  }\n}\n","<!--\n   Authors : initappz (Rahul Jograna)\n  Website : https://initappz.com/\n  App Name : ionic 5 groceryee app\n  Created : 10-Sep-2020\n  This App Template Source code is licensed as per the\n  terms found in the Website https://initappz.com/license\n  Copyright and Good Faith Purchasers © 2020-present initappz.\n -->\n<h2 style=\"text-align: center;\"> {{util.translate('Please wait, we are processing your order')}} </h2>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}